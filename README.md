# Horse Detecting Multi Recorder

이 스크립트는 여러 유튜브 채널의 라이브 방송을 자동으로 감지해 녹화하고
실시간으로 말 객체를 탐지하여 별도의 채증 영상을 저장합니다.

## 주요 기능

1. **라이브 감지 및 자동 녹화**
   - 특정 유튜브 채널을 주기적으로 확인하여 라이브 시작/종료를 자동 감지합니다.
   - 방송이 시작되면 즉시 녹화를 시작하고 종료 시 자동으로 중단합니다.
2. **다중 녹화 지원**
   - 여러 채널을 동시에 병렬로 녹화합니다.
   - 한국마사회 저작권 침해 감시와 같은 상황에 활용할 수 있습니다.
3. **사용자 친화적 설계**
   - 비전문가도 실행만으로 쉽게 사용할 수 있도록 기본 설정을 제공합니다.
   - 설정 파일 한 곳만 수정하면 간단하게 유지보수할 수 있습니다.
4. **실시간 말(Horse) 감지 및 채증**
   - 컴퓨터 비전 모델로 실시간 화면을 분석하여 말이 감지되면 `[경고]` 메시지를 표시합니다.
   - 본 녹화와 별개로 `evidence/` 폴더에 말이 사라질 때까지 별도 채증 영상을 저장합니다.
5. **수동 영상 분석**
   - 원하는 유튜브 링크를 직접 입력해 동일한 말 감지 로직을 실행할 수 있습니다.
6. **파일 분리 저장**
   - 일반 녹화본은 `recordings/`, 채증 영상은 `evidence/` 폴더에 체계적으로 구분하여 보관합니다.

=======

## 로그 확인

채널별 `yt_dlp` 실행 로그는 `recordings/<채널이름>.log` 파일에 기록됩니다.
로그 크기가 10MB를 초과하면 자동으로 덮어쓰며 새로운 내용이 저장됩니다.

예) `recordings/mychannel.log`

녹화 중 문제가 발생했는지 확인하고 싶을 때 해당 로그 파일을 열어보세요.

## 폴더 구조

일반 녹화물은 `recordings/` 폴더에,
말 감지 시 저장되는 증거 영상은 `evidence/` 폴더에 구분되어 저장됩니다.
이 위치는 `config.json`의 `evidence_folder` 값으로 변경할 수 있습니다.

## 수동 분석

`analyze.py` 스크립트를 이용하면 원하는 유튜브 영상 링크를 입력해
동일한 말 탐지 로직을 적용할 수 있습니다.

```
python analyze.py <youtube_url>
```
## 쿠키 파일 설정

로그인이 필요한 영상의 경우 브라우저에서 추출한 쿠키 파일을
`config.json`의 `"cookiefile"` 항목에 지정하면 접근할 수 있습니다. 쿠키는
반드시 Netscape 형식으로 저장해야 하며, 지정한 경로에 실제 파일이 존재해야
합니다.

```
{
  "cookiefile": "cookies.txt"
}
```

쿠키 파일을 찾을 수 없으면 프로그램이 즉시 종료되므로 경로를 정확히
확인하십시오.

## ffmpeg 설정

기본값으로 `ffmpeg` 실행 파일을 사용합니다. Windows 사용자는
`config.json`의 `"ffmpeg_exe"` 값을 `"ffmpeg.exe"`로 변경해야 합니다.


## 시스템 플로우

1. **자동 라이브 모니터링**
   - 시작 → 채널 목록 로드 → 주기적 상태 체크 → 라이브 감지
   - 녹화 시작 → 실시간 프레임 분석 → 말 감지 시 경고 및 채증
   - 라이브 종료 감지 → 녹화 중지 → 파일 저장 → 대기 상태 복귀
2. **수동 영상 분석**
   - 링크 입력 → URL 유효성 검증 → 영상 스트리밍 → 프레임 분석
   - 말 감지 → 경고 표시 → 채증 녹화 → 분석 완료 → 결과 저장
3. **말 감지 및 채증**
   - 프레임 입력 → YOLO 모델 분석 → 말 객체 감지
   - 신뢰도 > 임계값 → Warning 팝업 → 채증 녹화 시작
   - 연속 프레임 감지 → 말 사라짐 감지 → 채증 녹화 종료
=======
